<h2>Commands Management</h2>
<p>View and manage all game commands submitted by players.</p>

<div id="commands-data" data-commands='<%- JSON.stringify(commands || []) %>' style="display: none;"></div>

<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Player</th>
                <th>Army</th>
                <th>Turn</th>
                <th>Command Type</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% if (commands && commands.length > 0) { %>
                <% commands.forEach(function(command) { %>
                    <tr>
                        <td><%= command.id %></td>
                        <td><%= command.player_nick || 'Unknown' %></td>
                        <td><%= command.army_name || 'Unknown' %></td>
                        <td><%= command.turn_display || 'Unknown' %></td>
                        <td>
                            <span class="badge bg-primary"><%= command.command_type %></span>
                        </td>
                        <td>
                            <% if (command.status === 'pending') { %>
                                <span class="badge bg-warning">Pending</span>
                            <% } else if (command.status === 'processing') { %>
                                <span class="badge bg-info">Processing</span>
                            <% } else if (command.status === 'completed') { %>
                                <span class="badge bg-success">Completed</span>
                            <% } else if (command.status === 'failed') { %>
                                <span class="badge bg-danger">Failed</span>
                            <% } else { %>
                                <span class="badge bg-secondary"><%= command.status %></span>
                            <% } %>
                        </td>
                        <td><%= new Date(command.created_at).toLocaleString() %></td>
                        <td>
                            <button class="btn btn-sm btn-info" data-command-id="<%= command.id %>" data-action="view">
                                View Details
                            </button>
                            <button class="btn btn-sm btn-warning" data-command-id="<%= command.id %>" data-command-status="<%= command.status %>" data-action="edit">
                                Edit Status
                            </button>
                        </td>
                    </tr>
                <% }); %>
            <% } else { %>
                <tr>
                    <td colspan="8" class="text-center">No commands found</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<!-- Command Details Modal -->
<div class="modal fade" id="commandDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Command Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="commandDetailsContent">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Status Modal -->
<div class="modal fade" id="editStatusModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Command Status</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editStatusForm">
                    <input type="hidden" id="editCommandId">
                    <div class="form-group">
                        <label for="editStatus">Status:</label>
                        <select class="form-control" id="editStatus" required>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="completed">Completed</option>
                            <option value="failed">Failed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editResult">Result (JSON):</label>
                        <textarea class="form-control" id="editResult" rows="3" placeholder='{"message": "Command executed successfully"}'></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveCommandStatus()">Save Changes</button>
            </div>
        </div>
    </div>
</div>
